services:
  - type: web
    name: qaas-web
    runtime: docker
    repo: https://github.com/pythoninthegrass/qaas.git      # optional
    branch: main
    autoDeploy: false                                       # optional
    domains:
      - qaas.sh
    plan: starter                                           # free/starter/standard
    region: ohio                                            # oregon, ohio, frankfurt, or singapore
    disk:                                                   # starter/standard only
      name: web-data
      mountPath: /app
      sizeGB: 5
    registryCredential:                                     # https://dashboard.render.com/u/settings#registry-credentials
      fromRegistryCreds:
        name: GITHUB_TOKEN
    rootDir:                                                # default: top-level directory
    dockerContext: .
    dockerfilePath: Dockerfile
    healthCheckPath: /healthz
    envVars:
      - key: PORT
        fromGroup: qaas-settings
      - key: POSTGRES_DB
        fromGroup: qaas-settings
      - key: POSTGRES_URI
        fromGroup: qaas-settings
      - key: POSTGRES_HOST
        fromGroup: qaas-settings
      - key: POSTGRES_PASSWORD
        fromGroup: qaas-settings
      - key: POSTGRES_PORT
        fromGroup: qaas-settings

databases:
  - name: qaas-postgres
    databaseName: quotes                                    # optional (Render may add a suffix)
    user: postgres                                          # optional
    region: ohio                                            # oregon, ohio, frankfurt, or singapore
    postgresMajorVersion: 15                                # 12/13/14/15
    plan: free                                              # free/starter/standard
    ipAllowList:                                            # default: allow all (empyty list `[]` is internal only)
      - source: 172.127.40.244/24
        description: home
    envVars:
      - key: POSTGRES_DB
        fromGroup: qaas-settings
      - key: POSTGRES_URI
        fromGroup: qaas-settings
      - key: POSTGRES_HOST
        fromGroup: qaas-settings
      - key: POSTGRES_PASSWORD
        fromGroup: qaas-settings
      - key: POSTGRES_PORT
        fromGroup: qaas-settings
      - key: POSTGRES_USER
        fromGroup: qaas-settings
      - key: REGISTRY_URL
        value: ghcr.io
      - key: SERVICE
        fromGroup: qaas-settings
      - key: USER_NAME
        fromGroup: qaas-settings

envVarGroups:
- name: qaas-settings
  envVars:
    - key: PORT
      value: 8000
    - key: POSTGRES_DB
      sync: false
    - key: POSTGRES_URI
      fromDatabase:
        name: qaas-postgres
        property: connectionString
    - key: POSTGRES_HOST
      sync: false
    - key: POSTGRES_PASSWORD
      sync: false
    - key: POSTGRES_PORT
      sync: false
    - key: POSTGRES_USER
      sync: false
    - key: REGISTRY_URL
      value: ghcr.io
    - key: SERVICE
      sync: false
    - key: USER_NAME
      sync: false
